import{F as g,u as v,r as n,c as oe,j as s,b as e,s as ce,l as ie,f as de,n as G,o as ue,p as me,T as he,q as pe,t as Y,g as fe,L as ge,v as xe,w as be,x as ve}from"./index-bcb46a99.js";import{A as C,B as Q,a as S,b as Ne,c as ye,d as ke,e as we,E as R,t as j,f as U,g as Se,Q as b,h as Ce,i as Le,j as Fe,k as Te,l as Ae,L as D,H as $,u as X,m as Be,n as Pe,o as _,p as J,q as K,r as q,s as Re,N,v as Z,w as E,x as ee,y as te,T as ae,D as B,z as se,M as y,C as re,F as Ue,O as Ie}from"./App-aacd66e8.js";import{S as A}from"./Swap-ba08f6de.js";import{T as P}from"./Tooltip-b86a98be.js";import{U as Me}from"./UserController-0820a7af.js";import{r as je,s as De,u as _e,g as qe}from"./firebase.config-23e38e02.js";const W=g.i`bi bi-repeat`,Ee=({audioRef:t})=>{const{currentTrack:a,nextup:r}=v(u=>u.queue),[i,l]=n.useState(0),[o,c]=n.useState(!1),[d,h]=n.useState(!1),{playState:m,setPlayState:f}=n.useContext(C),k=oe();n.useEffect(()=>{t.current.addEventListener("ended",()=>{x(1)})});const L=u=>{c(u.target.checked),t.current.loop=u.target.checked},T=u=>{h(u.target.checked)},x=(()=>{let u;return function(I){if(d){u=Math.floor(Math.random()*r.length);let M=r.findIndex(V=>V._id===a._id);for(;M===u;)u=Math.floor(Math.random()*r.length)}else u=i+I,u<0&&(u=r.length-1),u>r.length-1&&(u=0);l(u),k(ce(r[u])),k(f(!0))}})();return s("div",{className:"flex items-center",children:[e(A,{swapon:e(Q,{className:"text-success"}),swapoff:e(Q,{}),tw:"text-xl w-fit",checked:d,onChange:T}),e(S,{color:"transparent",className:"text-2xl",onClick:()=>x(-1),children:e(Ne,{})}),e(A,{swapoff:e(ye,{}),swapon:e(ke,{}),tw:"swap-rotate btn btn-ghost btn-circle hover:bg-transparent text-4xl w-fit",checked:m,onChange:u=>f(u.target.checked)}),e(S,{color:"transparent",className:"text-2xl",onClick:()=>x(1),children:e(we,{})}),e(A,{swapon:e(W,{className:"text-success"}),swapoff:e(W,{className:"text-base-content"}),tw:"text-xl w-fit",checked:o,onChange:L})]})},le=({value:t,max:a,step:r=1,onChange:i,id:l})=>{const[o,c]=n.useState(0),[d,h]=n.useState(100);n.useEffect(()=>{t&&a&&(c(t),h(a))},[t,a]);const m=f=>{c(f.target.value),i&&i(f)};return e("input",{type:"range",id:l,step:r,max:d,value:o,style:{backgroundSize:`${o/d*100}%`},onChange:f=>m(f)})},Ve=({audioRef:t})=>{const[a,r]=n.useState(0),[i,l]=n.useState(0),{currentTrack:o}=v(h=>h.queue),{playState:c}=n.useContext(C);n.useEffect(()=>{if(c){const h=setInterval(()=>{l(t.current.currentTime)},1);r(h)}else clearInterval(a)},[c,o]);const d=h=>{t.current.currentTime=h.target.value,l(h.target.value)};return e(R,{children:s("div",{className:"flex min-w-full items-center justify-center gap-3 ",children:[e("span",{children:j(i)}),e(le,{type:"range",value:i,max:o==null?void 0:o.duration,onChange:d}),e("span",{children:o!=null&&o.duration?j(o==null?void 0:o.duration):j(0)})]})})},ze=()=>{const t=v(d=>d.queue.currentTrack),{authenticated:a}=v(d=>d.auth),{data:r}=ie(void 0,{skip:!a}),[i,l]=n.useState(!1),[o]=de();n.useEffect(()=>{if(a||l(!1),Array.isArray(r)){let d=Array.isArray(r)?r.some(h=>h._id===t._id):!1;l(d)}},[r,a]);const c=async d=>{try{if(!a){b.info("You have to login first!");return}if(!await o(d)){b.error("Cannot update track collection");return}l(!i),i?b.info("Removed track from your library"):b.success("Added track to your library")}catch{b.error("Opps! Something went wrong!")}};return e(A,{swapoff:e(U,{}),swapon:e(Se,{className:"text-success"}),checked:i,onChange:()=>c(t)})},Oe=n.memo(ze),He=g.div`flex justify-end items-center gap-4 basis-1/4 sm:flex-none md:flex-none `,Qe=g.div`flex items-center self-center gap-2 sm:hidden md:hidden`,We=({audioRef:t})=>{const[a,r]=n.useState(0),i=n.useId(),{playState:l,setPlayState:o}=n.useContext(C);n.useEffect(()=>{r(t.current.volume)},[t]);const c=d=>{r(d.target.value),t.current.volume=d.target.value};return e(R,{children:s(He,{children:[s(Qe,{children:[e("label",{htmlFor:"volume-range",className:"text-2xl",id:i,children:a===1?e(Ce,{}):a==0?e(Le,{}):e(Fe,{})}),e(le,{value:a,step:.01,max:1,onChange:c,id:"volume-range"})]}),e(S,{shape:"circle",size:"sm",color:"ghost",className:"hidden text-xl sm:inline-flex",onClick:()=>o(!l),children:l?e(Te,{}):e(Ae,{})}),e(Oe,{}),e(D,{to:"/queue",className:"hidden lg:block xl:block xxl:block",children:e($,{className:"text-xl"})})]})})},Ge=g.div`flex basis-1/4 items-center gap-4 sm:flex-1 md:flex-1 sm:text-sm`,Ye=g.img`h-12 w-12 rounded-md`,$e=g.h5`truncate font-semibold text-base-content`,Xe=()=>{const t=v(a=>a.queue.currentTrack);return s(Ge,{children:[e(Ye,{src:(t==null?void 0:t.thumbnail)||(t==null?void 0:t.alternativeThumbnail)}),s("div",{children:[e($e,{children:t==null?void 0:t.title}),e("p",{children:Array.isArray(t==null?void 0:t.artists)&&t.artists.map(a=>a.name).join(", ")})]})]})},Je=g.div`w-full flex flex-wrap xl:flex-nowrap xxl:flex-nowrap justify-between items-start xl:items-start xxl:items-start flex-grow gap-10 p-4 bg-base-300 border-t border-neutral-content/20 text-base-content`,Ke=g.div`flex flex-col gap-1 justify-center items-center flex-1 sm:basis-full md:basis-full sm:order-3 md:order-3 sm:hidden`,Ze=()=>{const t=n.useRef(),{currentTrack:a}=v(l=>l.queue),{playState:r,setPlayState:i}=n.useContext(C);return n.useEffect(()=>{r?t.current.play():t.current.pause()},[r,a]),s(Je,{children:[e(Xe,{}),s(Ke,{children:[e("audio",{src:a==null?void 0:a.trackSrc,preload:"metadata",ref:t}),e(Ve,{audioRef:t}),e(Ee,{audioRef:t})]}),e(We,{audioRef:t})]})},et=()=>{const t=X();return s("div",{className:"flex items-center gap-3 sm:hidden",children:[e(P,{"data-tip":"Go back",position:"bottom",children:e(S,{shape:"circle",color:"ghost",size:"sm",className:"text-2xl",onClick:()=>t(-1),children:e(Be,{})})}),e(P,{"data-tip":"Go forward",position:"bottom",children:e(S,{shape:"circle",color:"ghost",size:"sm",className:"text-2xl",onClick:()=>t(1),children:e(Pe,{})})})]})},tt=(t,a)=>{const r=n.useRef(null),[i,l]=n.useState(!1);return a=a||0,[(...o)=>{r.current&&(clearTimeout(r.current),r.current=null,l(!0)),r.current=setTimeout(()=>{l(!1),t(...o)},a)},i]},at=()=>{const t=n.useId(),a=X(),{setSearchResult:r}=n.useContext(C);async function i(c){try{const d=await ue.get("/search",{params:{keyword:c}});r(d),c===""&&r(null)}catch{}}const[l,o]=tt(i,500);return s("form",{className:"flex items-center gap-1 rounded-full border border-neutral bg-base-200 px-2 ",onSubmit:c=>{c.preventDefault()},children:[e("label",{htmlFor:"",className:"basis-1/6",children:o?e(G,{size:"xs"}):e(_,{className:"text-lg"})}),e("input",{type:"search",className:"input input-sm basis-5/6 rounded-full bg-transparent focus:outline-none",id:t,placeholder:"Search ...",onFocus:()=>a("/search"),onChange:c=>l(c.target.value)})]})},st=g.nav`navbar justify-between items-center p-5 gap-6`,rt=()=>{const{authenticated:t}=v(i=>i.auth),{data:a}=me(void 0,{skip:!t});n.useContext(he);const{pathname:r}=J();return s(st,{children:[s("div",{className:"flex items-center gap-4",children:[e(et,{}),r==="/search"&&e(at,{})]}),s("div",{className:"flex items-center gap-4",children:[e(P,{"data-tip":"Upload track",position:"bottom",children:e("label",{htmlFor:"upload-track-modal",role:"menuitem",className:"btn-ghost btn-circle btn hidden text-lg sm:inline-flex sm:btn-sm",children:e(K,{})})}),e(P,{"data-tip":"Create playlist",position:"bottom",children:e("label",{htmlFor:"create-playlist-modal",className:"btn-ghost btn-circle btn hidden text-lg sm:inline-flex sm:btn-sm",role:"menuitem",children:e(q,{className:"text-xl"})})}),t?e(Me,{user:a}):e(D,{to:"/login",className:"btn-circle btn text-xl sm:btn-sm",children:e(Re,{"aria-hidden":!0})})]})]})},lt=()=>s("div",{className:"btm-nav relative hidden bg-neutral-focus text-xl font-medium text-neutral-content sm:flex [&>*:where(.active)]:bg-neutral",children:[e(N,{to:"/",children:e(Z,{})}),e(N,{to:"/library",children:e(E,{})}),e(N,{to:"/search",children:e(_,{})}),e(N,{to:"/liked-tracks",children:e(U,{})}),e(N,{to:"/queue",children:e($,{})})]}),ne=()=>{const[t,a]=n.useState(!1),[r,i]=n.useState(!1);return{async upload(l,o){try{if(!o){b.error("Provide a file!");return}const c=je(De,l+(o==null?void 0:o.name));await _e(c,o),a(!0);const d=await qe(c);return a(!1),d}catch(c){console.log(c.message),a(!1),i(!0),b.error("Failed to upload file!")}},isUploading:t,isError:r}},nt=()=>{var F;const{register:t,formState:a,handleSubmit:r,reset:i}=ee();v(x=>{var u;return(u=x.auth)==null?void 0:u.credential});const[l,{isLoading:o}]=pe(),c=n.useRef(null),d=n.useRef(null),{upload:h,isUploading:m,isError:f}=ne(),k=x=>{const u=URL.createObjectURL(x.target.files[0]);c.current.src=u},L=()=>{i(),c.current.src=B},T=async x=>{try{const u=x.thumbnail.length>0?await h("pictures/",x.thumbnail[0]):void 0;await l({thumbnail:u,title:x.title}),d.current.click(),b.success("Created new playlist!")}catch(u){console.log(u.message)}};return s(n.Fragment,{children:[e("input",{type:"checkbox",id:"create-playlist-modal",className:"modal-toggle"}),e("div",{className:"modal",children:s("div",{className:"invisible-scroll modal-box max-w-sm",children:[e("label",{htmlFor:"create-playlist-modal",className:"btn-sm btn-circle btn absolute right-2 top-2",onClick:L,ref:d,children:e(te,{})}),s("form",{className:"flex flex-col gap-6",onSubmit:r(T),children:[s("div",{className:"form-control self-center",children:[e(ae,{className:"text-center",children:"Choose an image"}),s("div",{className:"group mask-square relative rounded-xl",children:[e("img",{src:B,alt:"",className:"h-[200px] w-[200px] object-contain",ref:c}),e("label",{htmlFor:"file",className:"absolute top-0 h-[200px] w-[200px] group-hover:bg-black/50 group-hover:duration-500",children:e(se,{className:"absolute top-1/2 left-1/2 -translate-x-1/2  translate-y-2 text-4xl text-success opacity-0 group-hover:-translate-y-1/2 group-hover:opacity-100 group-hover:duration-500"})})]}),e("input",{type:"file",id:"file",className:"invisible absolute",...t("thumbnail",{required:!1,onChange:x=>k(x)})})]}),s("div",{className:"form-control",children:[e("label",{htmlFor:"",className:"label",children:e("span",{className:"label-text",children:"Playlist's title"})}),e("input",{type:"text",className:"input-bordered input",placeholder:"Title",...t("title",{required:"Provide a title!",minLength:{value:3,message:"Playlist's title should have at least 6 characters!"}})}),a.title&&e("small",{className:"error-message",children:(F=a.title)==null?void 0:F.message})]}),e("div",{className:"form-control",children:s("label",{htmlFor:"",className:"label",children:[e("span",{className:"label-text",children:"Make it public"}),e("input",{type:"checkbox",className:"toggle-success toggle",...t("public")})]})}),e("div",{className:"form-control",children:e(S,{isLoading:m,color:"success",children:"Save"})})]})]})})]})},ot=()=>{const{credential:t,authenticated:a}=v(m=>m.auth),[r,i]=n.useState(null),{trackToEditPlaylist:l}=n.useContext(C),{data:o}=Y({id:t,params:{skip:0,limit:20}},{skip:!a}),[c,{isLoading:d}]=fe(),h=async m=>{try{if(i(m),m.tracks.some(k=>k._id===(l==null?void 0:l._id)))return;await c({id:m._id,payload:{track:l._id}}).unwrap()&&b.success(`Added to ${m.title}`)}catch{}};return s(n.Fragment,{children:[e("input",{type:"checkbox",id:"playlist-list-modal",className:"modal-toggle"}),e("label",{htmlFor:"playlist-list-modal",className:"modal cursor-pointer",children:s("label",{className:"modal-box relative",htmlFor:"",children:[e("h3",{className:"mb-6 text-center text-xl font-medium capitalize",children:"add to playlist"}),e("div",{className:"flex flex-col gap-1",children:Array.isArray(o)&&o.map(m=>s("label",{className:"label rounded-lg p-3 hover:bg-neutral/50 hover:duration-500",onClick:()=>h(m),children:[m.title,e(S,{size:"sm",isLoading:d&&r._id===m._id,disabled:m.tracks.some(f=>f._id===(l==null?void 0:l._id)),color:"success",children:"Add to playlist"})]},m==null?void 0:m._id))})]})})]})},ct=()=>s(n.Fragment,{children:[e(y,{onClick:()=>b.info("You have to signin to you this features"),children:s("a",{role:"menuitem",children:[e(E,{"aria-hidden":!0,className:"text-xl"}),"Library"]})}),e(y,{onClick:()=>b.info("You have to signin to you this features"),children:s("a",{role:"menuitem",children:[e(U,{"aria-hidden":!0,className:"text-xl"}),"Liked tracks"]})}),e(y,{onClick:()=>b.info("You have to signin to you this features"),children:s("a",{role:"menuitem",children:[e(q,{})," Create playlist"]})})]}),it=()=>s(n.Fragment,{children:[e(y,{children:s(N,{to:"/library",className:({isActive:t})=>t?"text-success":"",children:[e(E,{"aria-hidden":!0,className:"text-xl"}),"Library"]})}),e(y,{children:s(N,{to:"/liked-tracks",className:({isActive:t})=>t?"text-success":"",children:[e(U,{"aria-hidden":!0,className:"text-xl"}),"Liked Tracks"]})}),e(y,{children:s("label",{htmlFor:"upload-track-modal",role:"menuitem",children:[e(K,{className:"text-xl"})," Upload"]})}),e(y,{children:s("label",{role:"menuitem",htmlFor:"create-playlist-modal",children:[e(q,{className:"text-xl"})," Create playlist"]})})]}),dt=()=>{const{authenticated:t}=v(a=>a.auth);return s(re,{className:"min-w-[320px] text-base text-base-content",children:[e(y,{children:s(N,{to:"/",className:({isActive:a})=>a?"text-success":"",children:[e(Z,{"aria-hidden":!0,className:"text-xl"})," Home"]})}),e(y,{children:s(N,{to:"/search",className:({isActive:a})=>a?"text-success":"",children:[e(_,{"aria-hidden":!0,className:"text-xl"})," Search"]})}),t?e(it,{}):e(ct,{})]})},ut=()=>{const{credential:t,authenticated:a}=v(l=>l.auth),{data:r,isFetching:i}=Y({id:t,params:{skip:0,limit:20}},{skip:!a});return e("div",{className:"scroll overflow-y-auto",children:e(re,{children:Array.isArray(r)&&r.map(l=>e(y,{children:e(N,{to:`/playlist/${l==null?void 0:l._id}`,className:({isActive:o})=>o?"justify-between text-success":"justify-between text-base-content",children:l==null?void 0:l.title})},l==null?void 0:l._id))})})},mt=g.aside`drawer-side`,ht=g.label`drawer-overlay`,pt=g.div`p-2 bg-base-300 w-fit flex flex-col overflow-y-hidden text-neutral-content `,ft=g.img`max-w-[200px] aspect-[2/1] object-contain -translate-x-2`,gt=()=>{const t=n.useRef(),{authenticated:a}=v(r=>r.auth);return s(mt,{children:[e(ht,{htmlFor:"sidebar-toggle",ref:t}),s(pt,{children:[e(D,{to:"/",children:e(ft,{src:ge,loading:"eager"})}),e(dt,{}),e("div",{className:"divider"}),a&&e(ut,{})]})]})},xt=()=>{var z,O;const{register:t,formState:a,handleSubmit:r,reset:i}=ee(),[l,{isLoading:o}]=xe(),{data:c}=be({skip:0,limit:100}),{data:d}=ve(void 0),h=n.useRef(null),m=n.useRef(null),f=n.useRef(null),{upload:k,isUploading:L,isError:T}=ne(),[F,x]=n.useState(0),u=p=>{const w=URL.createObjectURL(p.target.files[0]);h.current.src=w},I=()=>{i(),h.current.src=B},M=async p=>{f.current.src=URL.createObjectURL(p.target.files[0]),f.current.preload="metadata";const w=await new Promise(H=>{f.current.addEventListener("loadedmetadata",()=>{H(f.current.duration)})});x(w)};return s(R,{children:[e("input",{type:"checkbox",id:"upload-track-modal",className:"modal-toggle"}),e("div",{className:"modal",children:s("div",{className:"invisible-scroll modal-box max-w-sm",children:[e("audio",{className:"hidden",ref:f}),e("label",{htmlFor:"upload-track-modal",className:"btn-sm btn-circle btn absolute right-2 top-2",onClick:I,ref:m,children:e(te,{})}),s("form",{className:"flex flex-col gap-6",onSubmit:r(async p=>{try{p.thumbnail=p.thumbnail.length>0?await k("pictures/",p.thumbnail[0]):void 0;const w=await k("music/",p.file[0]),H=await l({thumbnail:p.thumbnail,title:p.title,downloadUrl:w,trackSrc:w,duration:F});m.current.click(),b.success("Created new playlist!")}catch(w){return await Promise.reject(w)}}),children:[s("div",{className:"form-control self-center",children:[e(ae,{className:"text-center",children:"Choose an image"}),s("div",{className:"group mask-square relative rounded-xl",children:[e("img",{src:B,alt:"",className:"h-[200px] w-[200px] object-contain",ref:h}),e("label",{htmlFor:"track-thumbnail",className:"absolute top-0 h-[200px] w-[200px] group-hover:bg-black/50 group-hover:duration-500",children:e(se,{className:"absolute top-1/2 left-1/2 -translate-x-1/2 translate-y-2 text-4xl text-success opacity-0 group-hover:-translate-y-1/2 group-hover:opacity-100 group-hover:duration-500"})})]}),e("input",{type:"file",id:"track-thumbnail",className:"invisible absolute",...t("thumbnail",{required:!1,onChange:p=>u(p)})})]}),s("div",{className:"form-control relative",children:[e("input",{type:"text",className:"input-bordered input",placeholder:"Title",...t("title",{required:"Provide a title!",minLength:{value:3,message:"Track's title should have at least 6 characters!"}})}),a.title&&e("small",{className:"error-message",children:(z=a.title)==null?void 0:z.message})]}),e("div",{className:"form-control",children:s("select",{className:"select-bordered select",children:[e("option",{children:"-- Pick a genre --"}),Array.isArray(d)&&d.map(p=>e("option",{value:p._id,children:p.name},p._id))]})}),e("div",{className:"form-control",children:s("select",{name:"",id:"",className:"select-bordered select",children:[e("option",{value:"",children:"-- Tribute to an artist --"}),Array.isArray(c)&&c.map(p=>e("option",{value:p._id,children:p.name},p._id))]})}),s("div",{className:"form-control",children:[e("input",{type:"file",className:"file:btn ",...t("file",{required:"Provide a file!"}),onChange:p=>M(p)}),a.file&&e("small",{className:"error-message",children:(O=a.file)==null?void 0:O.message})]}),e("div",{className:"form-control",children:e(S,{isLoading:L,color:"success",className:"text-lg",children:"Save"})})]})]})})]})},bt=g.div`flex h-screen flex-col overflow-hidden`,vt=g.div`drawer drawer-mobile h-full`,Nt=g.div`invisible-scroll drawer-content relative flex flex-1 w-full flex-col  overflow-x-auto overflow-y-auto bg-base-200`,yt=g.div`flex flex-col w-full h-[inherit] gap-10 overflow-y-auto scroll sm:invisible-scroll overflow-x-hidden sm:p-2 p-6`,kt=g.input`drawer-toggle`,At=()=>{const{pathname:t}=J(),a=n.useRef(null),[r,i]=n.useState(null);return n.useEffect(()=>{a.current&&(a.current.checked=!1)},[t]),e(R,{children:e(Ue,{children:s(bt,{children:[s(vt,{children:[e(kt,{id:"sidebar-toggle",type:"checkbox",ref:a}),s(Nt,{children:[e(rt,{}),e(yt,{children:e(n.Suspense,{fallback:e("div",{className:"flex items-center justify-center p-20",children:e(G,{})}),children:e(Ie,{context:{trackToAddToPlaylist:r,setTrackToAddToPlaylist:i}})})})]}),e(gt,{})]}),e(Ze,{}),e(lt,{}),e(nt,{}),e(xt,{}),e(ot,{})]})})})};export{At as default};
