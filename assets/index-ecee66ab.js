import{F as g,u as v,r as n,c as oe,j as s,b as e,s as ce,l as ie,f as de,n as G,k as ue,o as me,T as he,p as fe,q as Y,g as pe,L as ge,t as xe,v as be,w as ve}from"./index-555376f6.js";import{A as C,B as Q,a as S,b as Ne,c as ye,d as ke,e as we,E as R,t as D,f as U,g as Se,Q as b,h as Ce,i as Le,j as Fe,k as Te,l as Ae,L as _,H as $,u as X,m as Be,n as Pe,o as q,p as J,q as K,r as E,s as Re,N,v as Z,w as V,x as ee,y as te,T as ae,D as B,z as se,M as y,C as re,F as Ue,O as Ie}from"./App-36a15c4e.js";import{S as A}from"./Swap-de83fdf3.js";import{T as P}from"./Tooltip-9f0259ee.js";import{U as Me}from"./UserController-0afb66a5.js";import{r as je,s as De,u as _e,g as qe}from"./firebase.config-4b21fc6f.js";const W=g.i`bi bi-repeat`,Ee=({audioRef:t})=>{const{currentTrack:a,nextup:r}=v(u=>u.queue),[d,l]=n.useState(0),[o,c]=n.useState(!1),[i,m]=n.useState(!1),{playState:h,setPlayState:p}=n.useContext(C),k=oe();n.useEffect(()=>{t.current.addEventListener("ended",()=>{x(1)})});const L=u=>{c(u.target.checked),t.current.loop=u.target.checked},T=u=>{m(u.target.checked)},x=(()=>{let u;return function(I){if(i){u=Math.floor(Math.random()*r.length);let M=r.findIndex(z=>z._id===a._id);for(;M===u;)u=Math.floor(Math.random()*r.length)}else u=d+I,u<0&&(u=r.length-1),u>r.length-1&&(u=0);l(u),k(ce(r[u])),k(p(!0))}})();return s("div",{className:"flex items-center",children:[e(A,{swapon:e(Q,{className:"text-success"}),swapoff:e(Q,{}),tw:"text-xl w-fit",checked:i,onChange:T}),e(S,{color:"transparent",className:"text-2xl",onClick:()=>x(-1),children:e(Ne,{})}),e(A,{swapoff:e(ye,{}),swapon:e(ke,{}),tw:"swap-rotate btn btn-ghost btn-circle hover:bg-transparent text-4xl w-fit",checked:h,onChange:u=>p(u.target.checked)}),e(S,{color:"transparent",className:"text-2xl",onClick:()=>x(1),children:e(we,{})}),e(A,{swapon:e(W,{className:"text-success"}),swapoff:e(W,{className:"text-base-content"}),tw:"text-xl w-fit",checked:o,onChange:L})]})},le=({value:t,max:a,step:r=1,onChange:d,id:l})=>{const[o,c]=n.useState(0),[i,m]=n.useState(100);n.useEffect(()=>{t&&a&&(c(t),m(a))},[t,a]);const h=p=>{c(p.target.value),d&&d(p)};return e("input",{type:"range",id:l,step:r,max:i,value:o,style:{backgroundSize:`${o/i*100}%`},onChange:p=>h(p)})},Ve=({audioRef:t})=>{const[a,r]=n.useState(0),[d,l]=n.useState(0),{currentTrack:o}=v(m=>m.queue),{playState:c}=n.useContext(C);n.useEffect(()=>{if(c){const m=setInterval(()=>{l(t.current.currentTime)},1);r(m)}else clearInterval(a)},[c,o]);const i=m=>{t.current.currentTime=m.target.value,l(m.target.value)};return e(R,{children:s("div",{className:"flex min-w-full items-center justify-center gap-3 ",children:[e("span",{children:D(d)}),e(le,{type:"range",value:d,max:o==null?void 0:o.duration,onChange:i}),e("span",{children:o!=null&&o.duration?D(o==null?void 0:o.duration):D(0)})]})})},ze=()=>{const t=v(i=>i.queue.currentTrack),{authenticated:a}=v(i=>i.auth),{data:r}=ie(void 0,{skip:!a}),[d,l]=n.useState(!1),[o]=de();n.useEffect(()=>{if(a||l(!1),Array.isArray(r)){let i=Array.isArray(r)?r.some(m=>m._id===t._id):!1;l(i)}},[r,a]);const c=async i=>{try{if(!a){b.info("You have to login first!");return}if(!await o(i)){b.error("Cannot update track collection");return}l(!d),d?b.info("Removed track from your library"):b.success("Added track to your library")}catch(m){console.log(m.message)}};return e(A,{swapoff:e(U,{}),swapon:e(Se,{className:"text-success"}),checked:d,onChange:()=>c(t)})},He=n.memo(ze),Oe=g.div`flex justify-end items-center gap-4 basis-1/4 sm:flex-none md:flex-none `,Qe=g.div`flex items-center self-center gap-2 sm:hidden md:hidden`,We=({audioRef:t})=>{const[a,r]=n.useState(0),d=n.useId(),{playState:l,setPlayState:o}=n.useContext(C);n.useEffect(()=>{r(t.current.volume)},[t]);const c=i=>{r(i.target.value),t.current.volume=i.target.value};return e(R,{children:s(Oe,{children:[s(Qe,{children:[e("label",{htmlFor:"volume-range",className:"text-2xl",id:d,children:a===1?e(Ce,{}):a==0?e(Le,{}):e(Fe,{})}),e(le,{value:a,step:.01,max:1,onChange:c,id:"volume-range"})]}),e(S,{shape:"circle",size:"sm",color:"ghost",className:"hidden text-xl sm:inline-flex",onClick:()=>o(!l),children:l?e(Te,{}):e(Ae,{})}),e(He,{}),e(_,{to:"/queue",className:"hidden lg:block xl:block xxl:block",children:e($,{className:"text-xl"})})]})})},Ge=g.div`flex basis-1/4 items-center gap-4 sm:flex-1 md:flex-1 sm:text-sm`,Ye=g.img`h-12 w-12 rounded-md`,$e=g.h5`truncate font-semibold text-base-content`,Xe=()=>{const t=v(a=>a.queue.currentTrack);return s(Ge,{children:[e(Ye,{src:(t==null?void 0:t.thumbnail)||(t==null?void 0:t.alternativeThumbnail)}),s("div",{children:[e($e,{children:t==null?void 0:t.title}),e("p",{children:Array.isArray(t==null?void 0:t.artists)&&t.artists.map(a=>a.name).join(", ")})]})]})},Je=g.div`w-full flex flex-wrap xl:flex-nowrap xxl:flex-nowrap justify-between items-start xl:items-start xxl:items-start flex-grow gap-10 p-4 bg-base-300 border-t border-neutral-content/20 text-base-content`,Ke=g.div`flex flex-col gap-1 justify-center items-center flex-1 sm:basis-full md:basis-full sm:order-3 md:order-3 sm:hidden`,Ze=()=>{const t=n.useRef(),{currentTrack:a}=v(l=>l.queue),{playState:r,setPlayState:d}=n.useContext(C);return n.useEffect(()=>{r?t.current.play():t.current.pause()},[r,a]),s(Je,{children:[e(Xe,{}),s(Ke,{children:[e("audio",{src:a==null?void 0:a.trackSrc,preload:"metadata",ref:t}),e(Ve,{audioRef:t}),e(Ee,{audioRef:t})]}),e(We,{audioRef:t})]})},et=()=>{const t=X();return s("div",{className:"flex items-center gap-3 sm:hidden",children:[e(P,{"data-tip":"Go back",position:"bottom",children:e(S,{shape:"circle",color:"ghost",size:"sm",className:"text-2xl",onClick:()=>t(-1),children:e(Be,{})})}),e(P,{"data-tip":"Go forward",position:"bottom",children:e(S,{shape:"circle",color:"ghost",size:"sm",className:"text-2xl",onClick:()=>t(1),children:e(Pe,{})})})]})},tt=(t,a)=>{const r=n.useRef(null),[d,l]=n.useState(!1);return a=a||0,[(...o)=>{r.current&&(clearTimeout(r.current),r.current=null,l(!0)),r.current=setTimeout(()=>{l(!1),t(...o)},a)},d]},at=()=>{const t=n.useId(),a=X(),{setSearchResult:r}=n.useContext(C);async function d(c){try{const i=await ue.get("/search",{params:{keyword:c}});r(i),c===""&&r(null)}catch(i){console.log(i.message)}}const[l,o]=tt(d,500);return s("form",{className:"flex items-center gap-1 rounded-full border border-neutral bg-base-200 px-2 ",onSubmit:c=>{c.preventDefault()},children:[e("label",{htmlFor:"",className:"basis-1/6",children:o?e(G,{size:"xs"}):e(q,{className:"text-lg"})}),e("input",{type:"search",className:"input input-sm basis-5/6 rounded-full bg-transparent focus:outline-none",id:t,placeholder:"Search ...",onFocus:()=>a("/search"),onChange:c=>l(c.target.value)})]})},st=g.nav`navbar justify-between items-center p-5 gap-6`,rt=()=>{const{authenticated:t}=v(d=>d.auth),{data:a}=me(void 0,{skip:!t});n.useContext(he);const{pathname:r}=J();return s(st,{children:[s("div",{className:"flex items-center gap-4",children:[e(et,{}),r==="/search"&&e(at,{})]}),s("div",{className:"flex items-center gap-4",children:[e(P,{"data-tip":"Upload track",position:"bottom",children:e("label",{htmlFor:"upload-track-modal",role:"menuitem",className:"btn-ghost btn-circle btn hidden text-lg sm:inline-flex sm:btn-sm",children:e(K,{})})}),e(P,{"data-tip":"Create playlist",position:"bottom",children:e("label",{htmlFor:"create-playlist-modal",className:"btn-ghost btn-circle btn hidden text-lg sm:inline-flex sm:btn-sm",role:"menuitem",children:e(E,{className:"text-xl"})})}),t?e(Me,{user:a}):e(_,{to:"/login",className:"btn-circle btn text-xl sm:btn-sm",children:e(Re,{"aria-hidden":!0})})]})]})},lt=()=>s("div",{className:"btm-nav relative hidden bg-neutral-focus text-xl font-medium text-neutral-content sm:flex [&>*:where(.active)]:bg-neutral",children:[e(N,{to:"/",children:e(Z,{})}),e(N,{to:"/library",children:e(V,{})}),e(N,{to:"/search",children:e(q,{})}),e(N,{to:"/liked-tracks",children:e(U,{})}),e(N,{to:"/queue",children:e($,{})})]}),ne=()=>{const[t,a]=n.useState(!1),[r,d]=n.useState(!1);return{async upload(l,o){try{if(!o){b.error("Provide a file!");return}const c=je(De,l+(o==null?void 0:o.name));await _e(c,o),a(!0);const i=await qe(c);return a(!1),i}catch(c){console.log(c.message),a(!1),d(!0),b.error("Failed to upload file!")}},isUploading:t,isError:r}},nt=()=>{var F;const{register:t,formState:a,handleSubmit:r,reset:d}=ee();v(x=>{var u;return(u=x.auth)==null?void 0:u.credential});const[l,{isLoading:o}]=fe(),c=n.useRef(null),i=n.useRef(null),{upload:m,isUploading:h,isError:p}=ne(),k=x=>{const u=URL.createObjectURL(x.target.files[0]);c.current.src=u},L=()=>{d(),c.current.src=B},T=async x=>{try{const u=x.thumbnail.length>0?await m("pictures/",x.thumbnail[0]):void 0;await l({thumbnail:u,title:x.title}),i.current.click(),b.success("Created new playlist!")}catch(u){console.log(u.message)}};return s(n.Fragment,{children:[e("input",{type:"checkbox",id:"create-playlist-modal",className:"modal-toggle"}),e("div",{className:"modal",children:s("div",{className:"invisible-scroll modal-box max-w-sm",children:[e("label",{htmlFor:"create-playlist-modal",className:"btn-sm btn-circle btn absolute right-2 top-2",onClick:L,ref:i,children:e(te,{})}),s("form",{className:"flex flex-col gap-6",onSubmit:r(T),children:[s("div",{className:"form-control self-center",children:[e(ae,{className:"text-center",children:"Choose an image"}),s("div",{className:"group mask-square relative rounded-xl",children:[e("img",{src:B,alt:"",className:"h-[200px] w-[200px] object-contain",ref:c}),e("label",{htmlFor:"file",className:"absolute top-0 h-[200px] w-[200px] group-hover:bg-black/50 group-hover:duration-500",children:e(se,{className:"absolute top-1/2 left-1/2 -translate-x-1/2  translate-y-2 text-4xl text-success opacity-0 group-hover:-translate-y-1/2 group-hover:opacity-100 group-hover:duration-500"})})]}),e("input",{type:"file",id:"file",className:"invisible absolute",...t("thumbnail",{required:!1,onChange:x=>k(x)})})]}),s("div",{className:"form-control",children:[e("label",{htmlFor:"",className:"label",children:e("span",{className:"label-text",children:"Playlist's title"})}),e("input",{type:"text",className:"input-bordered input",placeholder:"Title",...t("title",{required:"Provide a title!",minLength:{value:3,message:"Playlist's title should have at least 6 characters!"}})}),a.title&&e("small",{className:"error-message",children:(F=a.title)==null?void 0:F.message})]}),e("div",{className:"form-control",children:s("label",{htmlFor:"",className:"label",children:[e("span",{className:"label-text",children:"Make it public"}),e("input",{type:"checkbox",className:"toggle-success toggle",...t("public")})]})}),e("div",{className:"form-control",children:e(S,{isLoading:h,color:"success",children:"Save"})})]})]})})]})},ot=()=>{const{credential:t,authenticated:a}=v(h=>h.auth),[r,d]=n.useState(null),{trackToEditPlaylist:l}=n.useContext(C),{data:o}=Y({id:t,params:{skip:0,limit:20}},{skip:!a}),[c,{isLoading:i}]=pe(),m=async h=>{try{if(d(h),h.tracks.some(k=>k._id===(l==null?void 0:l._id)))return;const p=await c({id:h._id,payload:{track:l._id}}).unwrap();console.log(p),p&&b.success(`Added to ${h.title}`)}catch(p){console.log(p)}};return s(n.Fragment,{children:[e("input",{type:"checkbox",id:"playlist-list-modal",className:"modal-toggle"}),e("label",{htmlFor:"playlist-list-modal",className:"modal cursor-pointer",children:s("label",{className:"modal-box relative",htmlFor:"",children:[e("h3",{className:"mb-6 text-center text-xl font-medium capitalize",children:"add to playlist"}),e("div",{className:"flex flex-col gap-1",children:Array.isArray(o)&&o.map(h=>s("label",{className:"label rounded-lg p-3 hover:bg-neutral/50 hover:duration-500",onClick:()=>m(h),children:[h.title,e(S,{size:"sm",isLoading:i&&r._id===h._id,disabled:h.tracks.some(p=>p._id===(l==null?void 0:l._id)),color:"success",children:"Add to playlist"})]},h==null?void 0:h._id))})]})})]})},ct=()=>s(n.Fragment,{children:[e(y,{onClick:()=>b.info("You have to signin to you this features"),children:s("a",{role:"menuitem",children:[e(V,{"aria-hidden":!0,className:"text-xl"}),"Library"]})}),e(y,{onClick:()=>b.info("You have to signin to you this features"),children:s("a",{role:"menuitem",children:[e(U,{"aria-hidden":!0,className:"text-xl"}),"Liked tracks"]})}),e(y,{onClick:()=>b.info("You have to signin to you this features"),children:s("a",{role:"menuitem",children:[e(E,{})," Create playlist"]})})]}),it=()=>s(n.Fragment,{children:[e(y,{children:s(N,{to:"/library",className:({isActive:t})=>t?"text-success":"",children:[e(V,{"aria-hidden":!0,className:"text-xl"}),"Library"]})}),e(y,{children:s(N,{to:"/liked-tracks",className:({isActive:t})=>t?"text-success":"",children:[e(U,{"aria-hidden":!0,className:"text-xl"}),"Liked Tracks"]})}),e(y,{children:s("label",{htmlFor:"upload-track-modal",role:"menuitem",children:[e(K,{className:"text-xl"})," Upload"]})}),e(y,{children:s("label",{role:"menuitem",htmlFor:"create-playlist-modal",children:[e(E,{className:"text-xl"})," Create playlist"]})})]}),dt=()=>{const{authenticated:t}=v(a=>a.auth);return s(re,{className:"min-w-[320px] text-base text-base-content",children:[e(y,{children:s(N,{to:"/",className:({isActive:a})=>a?"text-success":"",children:[e(Z,{"aria-hidden":!0,className:"text-xl"})," Home"]})}),e(y,{children:s(N,{to:"/search",className:({isActive:a})=>a?"text-success":"",children:[e(q,{"aria-hidden":!0,className:"text-xl"})," Search"]})}),t?e(it,{}):e(ct,{})]})},ut=()=>{const{credential:t,authenticated:a}=v(l=>l.auth),{data:r,isFetching:d}=Y({id:t,params:{skip:0,limit:20}},{skip:!a});return e("div",{className:"scroll overflow-y-auto",children:e(re,{children:Array.isArray(r)&&r.map(l=>e(y,{children:e(N,{to:`/playlist/${l==null?void 0:l._id}`,className:({isActive:o})=>o?"justify-between text-success":"justify-between text-base-content",children:l==null?void 0:l.title})},l==null?void 0:l._id))})})},mt=g.aside`drawer-side`,ht=g.label`drawer-overlay`,ft=g.div`p-2 bg-base-300 w-fit flex flex-col overflow-y-hidden text-neutral-content `,pt=g.img`max-w-[200px] aspect-[2/1] object-contain -translate-x-2`,gt=()=>{const t=n.useRef(),{authenticated:a}=v(r=>r.auth);return s(mt,{children:[e(ht,{htmlFor:"sidebar-toggle",ref:t}),s(ft,{children:[e(_,{to:"/",children:e(pt,{src:ge,loading:"eager"})}),e(dt,{}),e("div",{className:"divider"}),a&&e(ut,{})]})]})},xt=()=>{var H,O;const{register:t,formState:a,handleSubmit:r,reset:d}=ee(),[l,{isLoading:o}]=xe(),{data:c}=be({skip:0,limit:100}),{data:i}=ve(void 0),m=n.useRef(null),h=n.useRef(null),p=n.useRef(null),{upload:k,isUploading:L,isError:T}=ne(),[F,x]=n.useState(0),u=f=>{const w=URL.createObjectURL(f.target.files[0]);m.current.src=w},I=()=>{d(),m.current.src=B},M=async f=>{p.current.src=URL.createObjectURL(f.target.files[0]),p.current.preload="metadata";const w=await new Promise(j=>{p.current.addEventListener("loadedmetadata",()=>{j(p.current.duration)})});x(w)};return s(R,{children:[e("input",{type:"checkbox",id:"upload-track-modal",className:"modal-toggle"}),e("div",{className:"modal",children:s("div",{className:"invisible-scroll modal-box max-w-sm",children:[e("audio",{className:"hidden",ref:p}),e("label",{htmlFor:"upload-track-modal",className:"btn-sm btn-circle btn absolute right-2 top-2",onClick:I,ref:h,children:e(te,{})}),s("form",{className:"flex flex-col gap-6",onSubmit:r(async f=>{try{f.thumbnail=f.thumbnail.length>0?await k("pictures/",f.thumbnail[0]):void 0;const w=await k("music/",f.file[0]),j=await l({thumbnail:f.thumbnail,title:f.title,downloadUrl:w,trackSrc:w,duration:F});console.log(j.data),h.current.click(),b.success("Created new playlist!")}catch(w){return console.log(w),await Promise.reject(w)}}),children:[s("div",{className:"form-control self-center",children:[e(ae,{className:"text-center",children:"Choose an image"}),s("div",{className:"group mask-square relative rounded-xl",children:[e("img",{src:B,alt:"",className:"h-[200px] w-[200px] object-contain",ref:m}),e("label",{htmlFor:"track-thumbnail",className:"absolute top-0 h-[200px] w-[200px] group-hover:bg-black/50 group-hover:duration-500",children:e(se,{className:"absolute top-1/2 left-1/2 -translate-x-1/2 translate-y-2 text-4xl text-success opacity-0 group-hover:-translate-y-1/2 group-hover:opacity-100 group-hover:duration-500"})})]}),e("input",{type:"file",id:"track-thumbnail",className:"invisible absolute",...t("thumbnail",{required:!1,onChange:f=>u(f)})})]}),s("div",{className:"form-control relative",children:[e("input",{type:"text",className:"input-bordered input",placeholder:"Title",...t("title",{required:"Provide a title!",minLength:{value:3,message:"Track's title should have at least 6 characters!"}})}),a.title&&e("small",{className:"error-message",children:(H=a.title)==null?void 0:H.message})]}),e("div",{className:"form-control",children:s("select",{className:"select-bordered select",children:[e("option",{children:"-- Pick a genre --"}),Array.isArray(i)&&i.map(f=>e("option",{value:f._id,children:f.name},f._id))]})}),e("div",{className:"form-control",children:s("select",{name:"",id:"",className:"select-bordered select",children:[e("option",{value:"",children:"-- Tribute to an artist --"}),Array.isArray(c)&&c.map(f=>e("option",{value:f._id,children:f.name},f._id))]})}),s("div",{className:"form-control",children:[e("input",{type:"file",className:"file:btn ",...t("file",{required:"Provide a file!"}),onChange:f=>M(f)}),a.file&&e("small",{className:"error-message",children:(O=a.file)==null?void 0:O.message})]}),e("div",{className:"form-control",children:e(S,{isLoading:L,color:"success",className:"text-lg",children:"Save"})})]})]})})]})},bt=g.div`flex h-screen flex-col overflow-hidden`,vt=g.div`drawer drawer-mobile h-full`,Nt=g.div`invisible-scroll drawer-content relative flex flex-1 w-full flex-col  overflow-x-auto overflow-y-auto bg-base-200`,yt=g.div`flex flex-col w-full h-[inherit] gap-10 overflow-y-auto scroll sm:invisible-scroll overflow-x-hidden sm:p-2 p-6`,kt=g.input`drawer-toggle`,At=()=>{const{pathname:t}=J(),a=n.useRef(null),[r,d]=n.useState(null);return n.useEffect(()=>{a.current&&(a.current.checked=!1)},[t]),e(R,{children:e(Ue,{children:s(bt,{children:[s(vt,{children:[e(kt,{id:"sidebar-toggle",type:"checkbox",ref:a}),s(Nt,{children:[e(rt,{}),e(yt,{children:e(n.Suspense,{fallback:e("div",{className:"flex items-center justify-center p-20",children:e(G,{})}),children:e(Ie,{context:{trackToAddToPlaylist:r,setTrackToAddToPlaylist:d}})})})]}),e(gt,{})]}),e(Ze,{}),e(lt,{}),e(nt,{}),e(xt,{}),e(ot,{})]})})})};export{At as default};
